{% extends 'page.html.twig' %}
{% block stylesheets %}

{% endblock %}
{% block javascripts %}
<script type="text/javascript">

$("#customer_details").on('click', '.edit', function (e) {
	e.preventDefault(); //STOP default action
	  var url = $(this).attr('href');
		        $.ajax({
					url: url,
					type: "GET",
					success: function(data) {
						$('#customer_details_form').html(data);
					},
					
					error: function(XMLHttpRequest, textStatus, errorThrown)
					{
					 alert('Error: ' +  errorThrown);
					}
				});			       
});


$("#customer_details_form").on('submit', "[name='trip_bookingenginebundle_customer_edit']", function (e) {
    var postData = $(this).serializeArray();
    var formURL = $(this).attr("action");
    $.ajax(
            {
                url : formURL,
                type: "POST",
                data : postData,
                success: function(data) {
                	$('#customer_details_form').html(data);
                },
                error: function(jqXHR, textStatus, errorThrown)
                {
                    //if fails
                    alert('Error: ' +  errorThrown);
                }
            });
    e.preventDefault(); //STOP default action
    e.unbind(); //unbind. to stop multiple form submit.
});	


$("#package_details").on('click', '.edit', function (e) {
	e.preventDefault(); //STOP default action
	  var url = $(this).attr('href');
		        $.ajax({
					url: url,
					type: "GET",
					success: function(data) {
						$('#package_details').html(data);
						$(".chosen-select").chosen({
			                no_results_text: "Oops, nothing found!"
			            });
			            $(".preferDate").datepicker({
			                dateFormat: "dd/mm/yy",
			                numberOfMonths: 2,
			                minDate: 0
			            });
			            $('.preferTime').timepicker({ 'scrollDefault': 'now' });
					},
					
					error: function(XMLHttpRequest, textStatus, errorThrown)
					{
					 alert('Error: ' +  errorThrown);
					}
				});			       
});

$("#package_details").on('click', ".adults", function (e) {
	e.preventDefault(); //STOP default action 
	 var id = $(this).attr('id');
	 var value = parseInt($(this).attr('value'));
	 //var adults =parseInt( $('#trip_custom_package_numAdult').val());
	 var numAdult = $(this).siblings(".numAdult");
	 var adults =parseInt(numAdult.val());
	 if (isNaN(adults)) { 
		 adults= 0
        } 
	 if(id=='decrement'){
		 adults-=1;
		 if(adults>=value) numAdult.val(adults); else exit();
	  }else{
		adults+=1;
	    if(adults<=20)  numAdult.val(adults); else exit();
		}							 		   			   							
});

$("#package_details").on('submit', "[name='trip_search_new_package']", function (e) {
    var postData = $(this).serializeArray();
    var formURL = $(this).attr("action");
    $.ajax(
            {
                url : formURL,
                type: "POST",
                data : postData,
                success: function(data) {
                	$('#package_details').html(data);
                	$(".chosen-select").chosen({
                        no_results_text: "Oops, nothing found!"
                    });
                    $(".preferDate").datepicker({
                        dateFormat: "dd/mm/yy",
                        numberOfMonths: 2,
                        minDate: 0
                    });
                    $('.preferTime').timepicker({ 'scrollDefault': 'now' });
                },
                error: function(jqXHR, textStatus, errorThrown)
                {
                    //if fails
                    alert('Error: ' +  errorThrown);
                }
            });
    e.preventDefault(); //STOP default action
    e.unbind(); //unbind. to stop multiple form submit.
});	




</script>
{% endblock %}

{% block breadcrumb %}
                    <ul class="c1 breadcrumb text-left">
                        <li><a href="#">Home</a></li>
                        <li>Custom Package</li>
                        <li>Review Custom Package</li>
                    </ul>
                    <h3></h3>
{% endblock %}

{% block body %}

    <section class="section clearfix">
    
    	
        <div class="container">
            <div class="row">
                <div id="fullwidth" class="col-sm-12">
                 <div class="row">
	                <div class="col-sm-8">
		                <h4>Customer Details</h4>
		             </div>
		             <div class="col-sm-4 text-right" id="customer_details">
		                	<a class="edit" href="{{ path('trip_booking_engine_edit_customer_details',{'id':customer.id}) }}">Edit</a>
		             </div>
		          </div>
		          
		          
                
                <div class="row">
                	<div class="col-lg-12" id="customer_details_form">
                		<div class="row">
			                <div class="col-sm-4">
			                	<label>Name</label>
			                	<p>{{ customer.name }}</p>
			                </div>
			                <div class="col-sm-4">
			                	<label>Email</label>
			                	<p>{{ customer.email }}</p>
			                </div>
			                <div class="col-sm-4">
			                	<label>Mobile</label>
			                	<p>{{ customer.mobile }}</p>
			                </div>
		                </div>
                	</div>
                </div>
             <hr>
                
            <h4>Package Details</h4>
            <div id="package_details">
<table  class="table table-bordered col-lg-12 col-sm-12">
<tr>
	<th>#</th>
	<th>Date</th>
	<th>Prefer Time</th>
	<th>Vehicle</th>
	<th>Pick Up</th>
	<th>Drop </th>
	<th>Places to Visit </th>
	<th>Adult</th>
	 {% if is_granted('ROLE_SUPER_ADMIN') %}
	<th>Price </th>	
	{% endif %}
	<th>Edit </th>
	
</tr>
<tbody>
{% if services|length>0 %}
    {% for service in services  %} 
        <tr>
            <td>{{ loop.index }}</td>
            <td> {{ service.date|date('F jS Y') }}  </td>
            <td>{{ service.preferTime }}</td>
            <td>{{ service.model }}</td>
            <td>           
            {% if service.leavingFrom %} 
                 {{ locations[service.leavingFrom].name }}
			{% endif %}             
    		</td>
    		<td> 
    		{% if service.goingTo %} 
                 {{ locations[service.goingTo].name }}
			{% endif %}     		        
    		</td>
    		<td>   
    		 {% if service.placesToVisit|length>0 %}                                                    
                                                            
            {% for p in service.placesToVisit %} 
                 {{ locations[p.location].name }} {% if loop.last is same as(false) %} , {% endif %}
             {% endfor %}
             {% else %}
                   N/A
              {% endif %}              
    		</td>
    		<td> {{ service.numAdult }} </td>
    		 {% if is_granted('ROLE_SUPER_ADMIN') %}
            <td> {{ service.price }} </td>
            {% endif %}
            <td><a class="edit" href="{{ path('trip_booking_engine_edit_custom_package',{ 'id': service.id }) }}"><i class="fa fa-pencil-square-o"></i></a></td>
        </tr>
    {% endfor %}
{% endif %}
</tbody>
</table>

 {% if is_granted('ROLE_SUPER_ADMIN') %}
 <div class="row">
 </div>
<hr>
 <h4>Fare Details</h4>
 
 <div class="row">
 		 <div class="col-lg-5">
 		 		<div class="row">
 					 <div class="col-lg-6">
 					 	<label>Total Fare</label>
 					 </div>
 					  <div class="col-lg-6">
 					  	<label>Rs {{ booking.totalPrice }}</label>
 					 </div>
 				</div>
 				<div class="row">
 					 <div class="col-lg-6">
 					 	<label>Service Tax (5.6%)</label>
 					 </div>
 					  <div class="col-lg-6">
 					  	<label>Rs {{ booking.serviceTax }}</label>
 					 </div>
 				</div>
 				<div class="row">
 					 <div class="col-lg-6">
 					 	<label>Swach Bharth Cess (0.2%)</label>
 					 </div>
 					  <div class="col-lg-6">
 					  	<label>Rs {{ booking.swachBharthCess }}</label>
 					 </div>
 				</div>
 				<div class="row">
 					 <div class="col-lg-6">
 					 	<label>Krishi Kalyan Cess (0.2%)</label>
 					 </div>
 					  <div class="col-lg-6">
 					  	<label>Rs {{ booking.krishiKalyanCess }}</label>
 					 </div>
 				</div>
 				<div class="row">
 					 <div class="col-lg-6">
 					 	<label>Final Price</label>
 					 </div>
 					  <div class="col-lg-6">
 					  	<label>Rs {{ booking.finalPrice }}</label>
 					 </div>
 				</div>
 		 </div>
 </div>
 
{% endif %}
  
</div>

<div class="row">
 		 <div class="col-lg-12 text-right">
 		 		<a class="btn btn-primary" href="{{ path('trip_booking_engine_confirm_custom_package',{'id':booking.bookingId}) }}">Confirm</a>
 		 </div>
 </div>
             </div>
            </div>
        </div>
    </section>
{% endblock %}